--
title: "Introduction to slimmmingDive"
author: "Fer Arce"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


This is a minimal example to introduce the usage of slimmingDive with
southern elephant seals dive information kindly provided by the
Australian Integrated Marine Observing System (IMOS). It requires the external software JAGS (Just another Gibs
sampler) to be installed or slimmingDive will fail to install.

slimmingDive is not on cran, so oyou need to download and install it
locally. You can also use either `remotes` or `devtools` packages



We load the data and see what's on it:
```{r }
library(slimmingDive)

data(ele)
dim(ele)
```
it contains a large number of columns, innecesary to our purposes, so
we preprocess the data. This step is important as it will rename and
create few extra variables needed for further processing.

```{r }

Data <- formatDives(ele)

dim(Data)
str(Data)
```

Next step is to otain the order in which the inflection points are
generated. As the Drifing segment and drift rate depends on them

```{r }

Data[c('order','minresid')] <- t(apply(Data,1,RBSM,retrieve='both'))
Data$minresid <- as.numeric(Data$minresid)
```
Next step is to generate a large bunch of variables for filtering purposes.

```{r }
D1 <- NewVarsVect(Data)
```
And the Drift rate and drifting segment

```{r }
D1[c('NDE','ds')] <- t(apply(D1,1,NDE, extract='both'))
```




```{r }
plotDrift(D1, xlab = 'foraging days', ylab = 'Drift rate',
          xlim = c(-10, 245))

```
We have a bunch of dives with associated drift rates at any value

Next step would be to get ridden of those that are certainly no drift
dives:


```{r }
D1 <- driftFilter(D1)


plotDrift(D1, xlab = 'foraging days', ylab = 'Drift rate', xlim = c(-10, 245))



```

A pattern aroses, but a last step is required to filter the
unrealistic values still retaining by the filtering process. Because
it is time consuming, we can load data as if just kalmaned

```{r }
data(eleK)


D2 <- PostKalman(eleK)
D2 <- D2[D2$zetas > .99, ]



plotDrift(D2, xlab = 'foraging days', ylab = 'Drift rate', xlim = c(-10, 245))

```
